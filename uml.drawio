classDiagram
    %% --- Interfaces ---
    class Animation {
        <<interface>>
        +doOneFrame(DrawSurface)
        +shouldStop() boolean
    }
    class Sprite {
        <<interface>>
        +drawOn(DrawSurface)
        +timePassed()
    }
    class Collidable {
        <<interface>>
        +getCollisionRectangle() Rectangle
        +hit(Ball, Point, Velocity) Velocity
    }
    class HitListener {
        <<interface>>
        +hitEvent(Block, Ball)
    }
    class HitNotifier {
        <<interface>>
        +addHitListener(HitListener)
        +removeHitListener(HitListener)
    }
    class LevelInformation {
        <<interface>>
        +numberOfBalls() int
        +initialBallVelocities() List~Velocity~
        +paddleSpeed() int
        +paddleWidth() int
        +levelName() String
        +getBackground() Sprite
        +blocks() List~Block~
        +numberOfBlocksToRemove() int
    }
    class BlockCreator {
        <<interface>>
        +create(int, int) Block
    }

    %% --- Core Game Logic ---
    class GameFlow {
        -AnimationRunner animationRunner
        -KeyboardSensor keyboardSensor
        -MouseSensor mouseSensor
        -ScorePersistence sp
        +runGame()
    }
    class GameLevel {
        -LevelInformation level
        -SpriteCollection sprites
        -GameEnvironment environment
        -Counter countBlocks
        -Counter countBalls
        +initialize()
        +run()
    }
    class GameEnvironment {
        -List~Collidable~ collisionsList
        +addCollidable(Collidable)
        +getClosestCollision(Line) CollisionInfo
    }
    class SpriteCollection {
        -List~Sprite~ spriteCollection
        +notifyAllTimePassed()
        +drawAllOn(DrawSurface)
    }
    class Counter {
        -int count
        +increase(int)
        +decrease(int)
        +getValue() int
    }

    %% --- Geometry ---
    class Point {
        -double x
        -double y
        +distance(Point) double
    }
    class Rectangle {
        -Point upperLeft
        -double width
        -double height
        +intersectionPoints(Line) List~Point~
    }
    class Line {
        -Point start
        -Point end
        +closestIntersectionToStartOfLine(Rectangle) Point
    }
    class Velocity {
        -double dx
        -double dy
        +applyToPoint(Point) Point
    }

    %% --- Actors & Objects ---
    class Ball {
        -Point center
        -int r
        -Velocity velocity
        -List~Image~ scaledBallFrames
        +moveOneStep()
    }
    class Block {
        -Rectangle rectangle
        -int hitPoints
        -List~HitListener~ hitListeners
        +hit(Ball, Point, Velocity) Velocity
    }
    class Paddle {
        -Rectangle paddleRect
        -double speed
        -long expandTimer
        -long speedTimer
        +moveLeft()
        +moveRight()
    }
    class PatrollingBlock {
        -double minX
        -double maxX
        -double moveSpeed
    }
    class ShiftingBlock {
        +setPosition(Point)
    }
    
    %% --- PowerUps ---
    class PowerUpManager {
        -List~PowerUp~ list
        +spawnRandomAt(int, int)
    }
    class PowerUp {
        -PowerUpType type
        -int x
        -int y
        +update()
    }
    class PowerUpType {
        <<enumeration>>
        EXPAND_PADDLE
        FAST_PADDLE
        MULTI_BALL
    }

    %% --- Animation Screens ---
    class AnimationRunner {
        +run(Animation)
    }
    class KeyPressStoppableAnimation {
        -Animation animation
        -String key
    }
    class CountdownAnimation {
        -double numOfSeconds
        -int countFrom
    }
    class PauseScreen
    class EndScreenWin
    class EndScreenLose
    class HighScoreScreen
    class MenuScreen

    %% --- Levels ---
    class LevelSpecificationReader {
        +fromReader(Reader) List~LevelInformation~
    }
    class BlocksFromSymbolsFactory {
        -Map~String, BlockCreator~ blockCreators
    }
    class LevelOne
    class LevelTwo
    class LevelThree
    class LevelFour

    %% --- Listeners & Sound ---
    class BlockRemover
    class BallRemover
    class ScoreTrackingListener
    class SoundPlayingHitListener
    class AudioPlayer {
        +play(String)
        +loop(String)
    }

    %% --- Relationships ---
    GameFlow --> GameLevel : runs
    GameFlow --> AnimationRunner : uses
    GameFlow --> MenuScreen : uses
    GameLevel ..|> Animation : implements
    GameLevel --> GameEnvironment : has
    GameLevel --> SpriteCollection : has
    
    GameEnvironment o-- Collidable : contains
    SpriteCollection o-- Sprite : contains
    
    Ball ..|> Sprite : implements
    Ball --> Velocity : uses
    Ball --> GameEnvironment : checks collision
    
    Block ..|> Collidable : implements
    Block ..|> Sprite : implements
    Block ..|> HitNotifier : implements
    Block --> Rectangle : has shape
    
    Paddle ..|> Collidable : implements
    Paddle ..|> Sprite : implements
    
    PatrollingBlock --|> Block : extends
    ShiftingBlock --|> Block : extends
    
    BlockRemover ..|> HitListener : implements
    BallRemover ..|> HitListener : implements
    ScoreTrackingListener ..|> HitListener : implements
    SoundPlayingHitListener ..|> HitListener : implements
    
    SoundPlayingHitListener --> AudioPlayer : uses
    
    PowerUpManager ..|> Sprite : implements
    PowerUpManager *-- PowerUp : manages
    PowerUp --> PowerUpType : uses
    
    LevelSpecificationReader --> LevelInformation : creates
    LevelSpecificationReader --> BlocksFromSymbolsFactory : uses
    BlocksFromSymbolsFactory --> BlockCreator : uses
    
    LevelOne ..|> LevelInformation : implements
    LevelTwo ..|> LevelInformation : implements
    LevelThree ..|> LevelInformation : implements
    LevelFour ..|> LevelInformation : implements
    
    KeyPressStoppableAnimation ..|> Animation : implements
    KeyPressStoppableAnimation o-- Animation : decorates
    
    MenuScreen ..|> Animation : implements
    HighScoreScreen ..|> Animation : implements
    EndScreenWin ..|> Animation : implements
    EndScreenLose ..|> Animation : implements